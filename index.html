<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ماشین حساب سیمپلکس</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Vazirmatn', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // آیکون Play
        const Play = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );

        // تابع برای تبدیل اعداد فارسی به انگلیسی
        function convertPersianToEnglish(str) {
            const persianNumbers = ['۰', '۱', '۲', '۳', '۴', '۵', '۶', '۷', '۸', '۹'];
            const arabicNumbers = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
            
            let result = str.toString();
            
            for (let i = 0; i < 10; i++) {
                const persianRegex = new RegExp(persianNumbers[i], 'g');
                const arabicRegex = new RegExp(arabicNumbers[i], 'g');
                result = result.replace(persianRegex, i).replace(arabicRegex, i);
            }
            
            return result;
        }

        // تابع برای تبدیل عدد اعشاری به کسر
        function decimalToFraction(decimal) {
            if (decimal === 0) return '0';
            
            const tolerance = 1.0e-6;
            let numerator = 1;
            let denominator = 1;
            let h1 = 1, h2 = 0, k1 = 0, k2 = 1;
            let b = decimal;
            
            const isNegative = decimal < 0;
            b = Math.abs(b);
            
            do {
                const a = Math.floor(b);
                let aux = h1;
                h1 = a * h1 + h2;
                h2 = aux;
                aux = k1;
                k1 = a * k1 + k2;
                k2 = aux;
                b = b - a;
                
                if (Math.abs(decimal - (isNegative ? -1 : 1) * h1 / k1) < tolerance) {
                    numerator = h1;
                    denominator = k1;
                    break;
                }
                
                if (b !== 0) {
                    b = 1 / b;
                }
            } while (Math.abs(b) > tolerance && k1 < 10000);
            
            numerator = isNegative ? -numerator : numerator;
            
            if (denominator === 1) {
                return numerator.toString();
            }
            
            return `${numerator}/${denominator}`;
        }

        function SimplexCalculator() {
            const [numVars, setNumVars] = useState('2');
            const [numConstraints, setNumConstraints] = useState('2');
            const [objective, setObjective] = useState(['0', '0']);
            const [constraints, setConstraints] = useState(
                Array(2).fill(null).map(() => ({
                    coefficients: ['0', '0'],
                    rhs: '0',
                    type: '<='
                }))
            );
            const [isMaximize, setIsMaximize] = useState(true);
            const [iterations, setIterations] = useState([]);
            const [error, setError] = useState('');

            const updateDimensions = (vars, cons) => {
                const numVarsInt = parseInt(vars) || 1;
                const numConsInt = parseInt(cons) || 1;

                setNumVars(numVarsInt.toString());
                setNumConstraints(numConsInt.toString());
                
                setObjective(prev => {
                    const newObj = Array(numVarsInt).fill('0');
                    for (let i = 0; i < Math.min(prev.length, numVarsInt); i++) {
                        newObj[i] = prev[i];
                    }
                    return newObj;
                });

                setConstraints(prev => {
                    const newCons = Array(numConsInt).fill(null).map((_, i) => {
                        if (i < prev.length) {
                            const newCoef = Array(numVarsInt).fill('0');
                            for (let j = 0; j < Math.min(prev[i].coefficients.length, numVarsInt); j++) {
                                newCoef[j] = prev[i].coefficients[j];
                            }
                            return { ...prev[i], coefficients: newCoef };
                        }
                        return { coefficients: Array(numVarsInt).fill('0'), rhs: '0', type: '<=' };
                    });
                    return newCons;
                });
            };

            const solveSimplex = () => {
                setError('');
                setIterations([]);

                try {
                    const m = parseInt(numConstraints) || 1;
                    const n = parseInt(numVars) || 1;
                    
                    const tableau = [];
                    
                    for (let i = 0; i < m; i++) {
                        const row = [];
                        for (let j = 0; j < n; j++) {
                            const val = parseFloat(constraints[i].coefficients[j]);
                            row.push(isNaN(val) ? 0 : val);
                        }
                        for (let j = 0; j < m; j++) {
                            row.push(i === j ? 1 : 0);
                        }
                        const rhsVal = parseFloat(constraints[i].rhs);
                        row.push(isNaN(rhsVal) ? 0 : rhsVal);
                        tableau.push(row);
                    }

                    const objRow = [];
                    for (let j = 0; j < n; j++) {
                        const val = parseFloat(objective[j]);
                        const coef = isNaN(val) ? 0 : val;
                        objRow.push(isMaximize ? -coef : coef);
                    }
                    for (let j = 0; j < m; j++) {
                        objRow.push(0);
                    }
                    objRow.push(0);
                    tableau.push(objRow);

                    const iters = [];
                    let iterCount = 0;
                    const maxIter = 50;

                    let basis = Array(m).fill(null).map((_, i) => n + i);

                    while (iterCount < maxIter) {
                        iters.push({
                            tableau: tableau.map(row => [...row]),
                            basis: [...basis],
                            iteration: iterCount
                        });

                        const objRow = tableau[m];
                        let pivotCol = -1;
                        let minValue = 0;

                        for (let j = 0; j < n + m; j++) {
                            if (objRow[j] < minValue) {
                                minValue = objRow[j];
                                pivotCol = j;
                            }
                        }

                        if (pivotCol === -1) {
                            break;
                        }

                        let pivotRow = -1;
                        let minRatio = Infinity;

                        for (let i = 0; i < m; i++) {
                            if (tableau[i][pivotCol] > 0) {
                                const ratio = tableau[i][n + m] / tableau[i][pivotCol];
                                if (ratio >= 0 && ratio < minRatio) {
                                    minRatio = ratio;
                                    pivotRow = i;
                                }
                            }
                        }

                        if (pivotRow === -1) {
                            setError('مسئله نامحدود است!');
                            return;
                        }

                        basis[pivotRow] = pivotCol;

                        const pivotElement = tableau[pivotRow][pivotCol];
                        
                        for (let j = 0; j < n + m + 1; j++) {
                            tableau[pivotRow][j] /= pivotElement;
                        }

                        for (let i = 0; i <= m; i++) {
                            if (i !== pivotRow) {
                                const factor = tableau[i][pivotCol];
                                for (let j = 0; j < n + m + 1; j++) {
                                    tableau[i][j] -= factor * tableau[pivotRow][j];
                                }
                            }
                        }

                        iterCount++;
                    }

                    iters.push({
                        tableau: tableau.map(row => [...row]),
                        basis: [...basis],
                        iteration: iterCount,
                        isFinal: true
                    });

                    setIterations(iters);

                } catch (err) {
                    setError('خطا در محاسبات: ' + err.message);
                }
            };

            const getVariableName = (index) => {
                if (index < numVars) {
                    return `x${index + 1}`;
                } else {
                    return `s${index - numVars + 1}`;
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6">
                    <div className="max-w-7xl mx-auto">
                        <div className="bg-white rounded-2xl shadow-xl p-8">
                            <h1 className="text-4xl font-bold text-center text-indigo-900 mb-8" dir="rtl">
                                ماشین حساب سیمپلکس
                            </h1>

                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2 text-right" dir="rtl">
                                        تعداد متغیرها
                                    </label>
                                    <input
                                        type="text"
                                        inputMode="numeric"
                                        value={numVars}
                                        onChange={(e) => {
                                            const val = convertPersianToEnglish(e.target.value);
                                            setNumVars(val);
                                            const num = parseInt(val);
                                            if (!isNaN(num) && num >= 1 && num <= 10) {
                                                updateDimensions(num, parseInt(numConstraints) || 1);
                                            }
                                        }}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-left"
                                        dir="ltr"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2 text-right" dir="rtl">
                                        تعداد محدودیت‌ها
                                    </label>
                                    <input
                                        type="text"
                                        inputMode="numeric"
                                        value={numConstraints}
                                        onChange={(e) => {
                                            const val = convertPersianToEnglish(e.target.value);
                                            setNumConstraints(val);
                                            const num = parseInt(val);
                                            if (!isNaN(num) && num >= 1 && num <= 10) {
                                                updateDimensions(parseInt(numVars) || 1, num);
                                            }
                                        }}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-left"
                                        dir="ltr"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium text-gray-700 mb-2 text-right" dir="rtl">
                                        نوع بهینه‌سازی
                                    </label>
                                    <select
                                        value={isMaximize ? 'max' : 'min'}
                                        onChange={(e) => setIsMaximize(e.target.value === 'max')}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-right"
                                        dir="rtl"
                                    >
                                        <option value="max">حداکثرسازی</option>
                                        <option value="min">حداقل‌سازی</option>
                                    </select>
                                </div>
                            </div>

                            <div className="mb-8 p-6 bg-indigo-50 rounded-xl">
                                <h2 className="text-xl font-bold text-indigo-900 mb-4 text-right" dir="rtl">
                                    {isMaximize ? 'حداکثرسازی' : 'حداقل‌سازی'} Z =
                                </h2>
                                <div className="flex flex-wrap gap-3 items-center" dir="ltr">
                                    {objective.map((coef, i) => (
                                        <div key={i} className="flex items-center gap-2">
                                            <input
                                                type="text"
                                                inputMode="decimal"
                                                value={coef}
                                                onChange={(e) => {
                                                    let val = convertPersianToEnglish(e.target.value);
                                                    val = val.replace(/[^\d.-]/g, '');
                                                    const newObj = [...objective];
                                                    newObj[i] = val;
                                                    setObjective(newObj);
                                                }}
                                                onBlur={(e) => {
                                                    if (e.target.value === '' || e.target.value === '-' || e.target.value === '.') {
                                                        const newObj = [...objective];
                                                        newObj[i] = '0';
                                                        setObjective(newObj);
                                                    }
                                                }}
                                                className="w-20 px-3 py-2 border border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-left"
                                                dir="ltr"
                                                placeholder="0"
                                            />
                                            <span className="font-medium text-indigo-900">x{i + 1}</span>
                                            {i < objective.length - 1 && <span className="text-indigo-600">+</span>}
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="mb-8">
                                <h2 className="text-xl font-bold text-gray-900 mb-4 text-right" dir="rtl">محدودیت‌ها</h2>
                                {constraints.map((constraint, i) => (
                                    <div key={i} className="mb-4 p-4 bg-gray-50 rounded-lg">
                                        <div className="flex flex-wrap gap-3 items-center" dir="ltr">
                                            {constraint.coefficients.map((coef, j) => (
                                                <div key={j} className="flex items-center gap-2">
                                                    <input
                                                        type="text"
                                                        inputMode="decimal"
                                                        value={coef}
                                                        onChange={(e) => {
                                                            let val = convertPersianToEnglish(e.target.value);
                                                            val = val.replace(/[^\d.-]/g, '');
                                                            const newCons = [...constraints];
                                                            newCons[i].coefficients[j] = val;
                                                            setConstraints(newCons);
                                                        }}
                                                        onBlur={(e) => {
                                                            if (e.target.value === '' || e.target.value === '-' || e.target.value === '.') {
                                                                const newCons = [...constraints];
                                                                newCons[i].coefficients[j] = '0';
                                                                setConstraints(newCons);
                                                            }
                                                        }}
                                                        className="w-20 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-left"
                                                        dir="ltr"
                                                        placeholder="0"
                                                    />
                                                    <span className="font-medium">x{j + 1}</span>
                                                    {j < constraint.coefficients.length - 1 && <span>+</span>}
                                                </div>
                                            ))}
                                            <select
                                                value={constraint.type}
                                                onChange={(e) => {
                                                    const newCons = [...constraints];
                                                    newCons[i].type = e.target.value;
                                                    setConstraints(newCons);
                                                }}
                                                className="px-3 py-2 border border-gray-300 rounded-lg"
                                            >
                                                <option value="<=">≤</option>
                                                <option value=">=">≥</option>
                                                <option value="=">=</option>
                                            </select>
                                            <input
                                                type="text"
                                                inputMode="decimal"
                                                value={constraint.rhs}
                                                onChange={(e) => {
                                                    let val = convertPersianToEnglish(e.target.value);
                                                    val = val.replace(/[^\d.-]/g, '');
                                                    const newCons = [...constraints];
                                                    newCons[i].rhs = val;
                                                    setConstraints(newCons);
                                                }}
                                                onBlur={(e) => {
                                                    if (e.target.value === '' || e.target.value === '-' || e.target.value === '.') {
                                                        const newCons = [...constraints];
                                                        newCons[i].rhs = '0';
                                                        setConstraints(newCons);
                                                    }
                                                }}
                                                className="w-20 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 text-left"
                                                dir="ltr"
                                                placeholder="0"
                                            />
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <button
                                onClick={solveSimplex}
                                className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-6 rounded-xl transition-colors flex items-center justify-center gap-2"
                            >
                                <Play size={24} />
                                <span dir="rtl">حل مسئله</span>
                            </button>

                            {error && (
                                <div className="mt-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg text-right" dir="rtl">
                                    {error}
                                </div>
                            )}

                            {iterations.length > 0 && (
                                <div className="mt-8 space-y-6">
                                    <h2 className="text-2xl font-bold text-gray-900 text-right" dir="rtl">مراحل حل:</h2>
                                    
                                    {iterations.map((iter, idx) => (
                                        <div key={idx} className="p-6 bg-gradient-to-br from-green-50 to-blue-50 rounded-xl shadow-lg">
                                            <h3 className="text-xl font-bold mb-4 text-indigo-900 text-right" dir="rtl">
                                                {iter.isFinal ? 'جواب بهینه' : `تکرار ${iter.iteration}`}
                                            </h3>
                                            
                                            <div className="mb-4 p-3 bg-white rounded-lg text-right" dir="rtl">
                                                <span className="font-semibold">متغیرهای پایه: </span>
                                                {iter.basis.map((b, i) => (
                                                    <span key={i} className="mx-2 text-indigo-700 font-medium">
                                                        {getVariableName(b)}
                                                    </span>
                                                ))}
                                            </div>

                                            <div className="overflow-x-auto">
                                                <table className="w-full border-collapse bg-white rounded-lg overflow-hidden shadow">
                                                    <thead>
                                                        <tr className="bg-indigo-600 text-white">
                                                            <th className="border border-indigo-500 px-3 py-2">پایه</th>
                                                            {Array(parseInt(numVars) + parseInt(numConstraints)).fill(null).map((_, i) => (
                                                                <th key={i} className="border border-indigo-500 px-3 py-2">
                                                                    {getVariableName(i)}
                                                                </th>
                                                            ))}
                                                            <th className="border border-indigo-500 px-3 py-2">سمت راست</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {iter.tableau.slice(0, parseInt(numConstraints)).map((row, i) => (
                                                            <tr key={i} className="hover:bg-indigo-50">
                                                                <td className="border border-gray-300 px-3 py-2 font-semibold text-indigo-700">
                                                                    {getVariableName(iter.basis[i])}
                                                                </td>
                                                                {row.map((val, j) => (
                                                                    <td key={j} className="border border-gray-300 px-3 py-2 text-center">
                                                                        {decimalToFraction(val)}
                                                                    </td>
                                                                ))}
                                                            </tr>
                                                        ))}
                                                        <tr className="bg-yellow-100 font-bold">
                                                            <td className="border border-gray-300 px-3 py-2">Z</td>
                                                            {iter.tableau[numConstraints].map((val, j) => (
                                                                <td key={j} className="border border-gray-300 px-3 py-2 text-center">
                                                                    {decimalToFraction(val)}
                                                                </td>
                                                            ))}
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>

                                            {iter.isFinal && (
                                                <div className="mt-6 p-4 bg-green-100 rounded-lg">
                                                    <h4 className="text-lg font-bold text-green-900 mb-3 text-right" dir="rtl">نتیجه نهایی:</h4>
                                                    <div className="space-y-2" dir="ltr">
                                                        {iter.basis.map((b, i) => {
                                                            if (b < numVars) {
                                                                return (
                                                                    <div key={i} className="text-green-800 font-medium text-left">
                                                                        x{b + 1} = {decimalToFraction(iter.tableau[i][numVars + numConstraints])}
                                                                    </div>
                                                                );
                                                            }
                                                            return null;
                                                        })}
                                                        <div className="text-xl font-bold text-green-900 mt-4 text-left">
                                                            Z = {decimalToFraction((isMaximize ? -1 : 1) * iter.tableau[numConstraints][numVars + numConstraints])}
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                        
                        {/* Footer */}
                        <div className="mt-6 text-center text-gray-600 py-4">
                            <p dir="rtl" className="text-sm">
                                نسخه v0.1 | ساخته شده توسط A.H.M
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<SimplexCalculator />);
    </script>
</body>
</html>